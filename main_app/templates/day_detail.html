{% extends 'base.html' %}

{% block content %}
  <h1>Day Detail</h1>

  <h2>{{ day.name }}</h2>
  <form action="{% url 'recipe_search' week.pk day.pk %}" method="get">
    <input type="text" name="query" placeholder="Search recipes" value="{{ query }}">
    <button type="submit">Search</button>
  </form>

  {% if recipes %}
    <h3>Recipes</h3>
    <ul>
      {% for recipe in recipes %}
        <li>
          <h4>{{ recipe.strMeal }}</h4>
          {% if recipe.idMeal %}
            <p>idMeal: {{ recipe.idMeal }}</p>
          {% endif %}
          <img src="{{ recipe.strMealThumb }}" alt="{{ recipe.strMeal }}">
          <p>{{ recipe.strInstructions }}</p>
          {% if recipe.ingredients %}
            <h5>Ingredients:</h5>
            <ul>
              {% for key, value in recipe.items %}
                {% if key|slice:"0:13" == "strIngredient" and value %}
                  <li>{{ value }}</li>
                {% endif %}
              {% endfor %}
            </ul>
          {% endif %}
          {% if recipe.strYoutube %}
          <a href="{{ recipe.strYoutube }}">Watch the Recipe Video</a>
          {% endif %}

          {% if recipe.strSource %}
          <a href="{{ recipe.strSource }}">Recipe Source</a>
          {% endif %}

          {% if recipe.recipe_id %}
            <form method="POST" action="{% url 'save_recipe' week.id day.id recipe.recipe_id %}">
          {% endif %}
            {% csrf_token %}
            {% if recipe.recipe_id %}
            <input type="hidden" name="name" value="{{ recipe.strMeal }}">
            <input type="hidden" name="instructions" value="{{ recipe.strInstructions }}">
            <input type="hidden" name="thumbnail" value="{{ recipe.strMealThumb }}">
            <input type="hidden" name="ingredients" value="{{ recipe.ingredients }}">
            <input type="hidden" name="video_link" value="{{ recipe.strYoutube }}">
            <input type="hidden" name="source_link" value="{{ recipe.strSource }}">
            <button type="submit">Save Recipe</button>
          </form>
          {% endif %}
        </li>
      {% empty %}
        <li>No recipes found</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No recipes found</p>
  {% endif %}

  {% if saved_recipes %}
    <h3>Saved Recipes</h3>
    <ul>
      {% for recipe in saved_recipes %}
        <li>
          <h4>{{ recipe.name }}</h4>
          <img src="{{ recipe.thumbnail }}" alt="{{ recipe.name }}">
          <p>{{ recipe.instructions }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No recipes saved yet</p>
  {% endif %}

  <div class="card-action">
    <a href="{% url 'days_update' day.id %}">Edit Day</a>
    <a href="{% url 'days_delete' day.id %}">Delete Day</a>
  </div>
{% endblock %}
